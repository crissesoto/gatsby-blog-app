---
title: How to Use Promise.any()
subtitle: Let’s see how Promise.any() works.
date: 2021-11-11
slug: how-to-use-promise.any
author: Dmitri Pavlutin
rating: 4
coverImage: https://dmitripavlutin.com/static/11a2422561b7085c389504232f0b5107/65311/cover.webp
---

<img src="https://dmitripavlutin.com/static/11a2422561b7085c389504232f0b5107/65311/cover.webp" width="100%"/>

<h3 id="1-promiseany" style="position:relative;"><a href="#1-promiseany" aria-label="1 promiseany permalink" class="anchor before"></a>1. <em>Promise.any()</em></h3>
<p><code>Promise.any()</code> is useful to perform independent async operations in a parallel and race manner, to get the value of any first fulfilled promise.</p>
<p>The function accepts an array (or generally an iterable) of promises as an argument:</p>
<pre class="shiki github-light" style="background-color: #fff; color: #24292e"><div class="language-id">javascript</div><div class='code-container'><code><div class='line'><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">anyPromise</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">Promise</span><span style="color: #24292E">.</span><span style="color: #6F42C1">any</span><span style="color: #24292E">(promises);</span></div></code></div></pre>
<p>When <em>any</em> first promise from the input <code>promises</code> is fulfilled, right away the <code>anyPromise</code> resolves to the value of that promise.</p>
<p>You can extract the value of the first promise using a <code>then</code>-able syntax:</p>
<pre class="shiki github-light" style="background-color: #fff; color: #24292e"><div class="language-id">javascript</div><div class='code-container'><code><div class='line'><span style="color: #24292E">anyPromise.</span><span style="color: #6F42C1">then</span><span style="color: #24292E">(</span><span style="color: #E36209">firstValue</span><span style="color: #24292E"> </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></div><div class='line'><span style="color: #24292E"> firstValue; </span><span style="color: #6A737D">// The value of the first fulfilled promise</span></div><div class='line'><span style="color: #24292E">});</span></div></code></div></pre>
<p>or using an <code>async/await</code> syntax:</p>
<pre class="shiki github-light" style="background-color: #fff; color: #24292e"><div class="language-id">javascript</div><div class='code-container'><code><div class='line'><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">firstValue</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> anyPromise;</span></div><div class='line'></div><div class='line'><span style="color: #24292E">firstValue; </span><span style="color: #6A737D">// The value of the first fulfilled promise</span></div></code></div></pre>
<p>The promise returned by <code>Promise.any()</code> <em>fulfills with any first fulfilled promise</em>. Even if some promises get rejected, these rejections are ignored.</p>
<p>However, if <em>all promises in the input array are rejected</em> or <em>if the input array is empty</em>, then <code>Promise.any()</code> rejects with an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AggregateError">aggregate error</a> containing all the rejection reasons of the input promises.</p>
<h2 id="2-fruits-and-vegetables" style="position:relative;"><a href="#2-fruits-and-vegetables" aria-label="2 fruits and vegetables permalink" class="anchor before"></a>2. Fruits and vegetables</h2>
<p>Before diving into <code>Promise.any()</code>, let’s define 2 simple helper functions.</p>
<p>First, <code>resolveTimeout(value, delay)</code> — returns a promise that fulfills with <code>value</code> after passing <code>delay</code> time:</p>
<pre class="shiki github-light" style="background-color: #fff; color: #24292e"><div class="language-id">javascript</div><div class='code-container'><code><div class='line'><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">resolveTimeout</span><span style="color: #24292E">(</span><span style="color: #E36209">value</span><span style="color: #24292E">, </span><span style="color: #E36209">delay</span><span style="color: #24292E">) {</span></div><div class='line'><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #005CC5">Promise</span><span style="color: #24292E">(</span></div><div class='line'><span style="color: #24292E">    </span><span style="color: #E36209">resolve</span><span style="color: #24292E"> </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">setTimeout</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">resolve</span><span style="color: #24292E">(value), delay)</span></div><div class='line'><span style="color: #24292E">  );</span></div><div class='line'><span style="color: #24292E">}</span></div></code></div></pre>
<p>Second, <code>rejectTimeout(reason, delay)</code> — returns a promise that rejects with <code>reason</code> after passing <code>delay</code> time:</p>
<pre class="shiki github-light" style="background-color: #fff; color: #24292e"><div class="language-id">javascript</div><div class='code-container'><code><div class='line'><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">rejectTimeout</span><span style="color: #24292E">(</span><span style="color: #E36209">reason</span><span style="color: #24292E">, </span><span style="color: #E36209">delay</span><span style="color: #24292E">) {</span></div><div class='line'><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #005CC5">Promise</span><span style="color: #24292E">(</span></div><div class='line'><span style="color: #24292E">    (</span><span style="color: #E36209">r</span><span style="color: #24292E">, </span><span style="color: #E36209">reject</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">setTimeout</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">reject</span><span style="color: #24292E">(reason), delay)</span></div><div class='line'><span style="color: #24292E">  );</span></div><div class='line'><span style="color: #24292E">}</span></div></code></div></pre>
<p>Let’s use these helper functions to experiment on <code>Promise.any()</code>.</p>
<h3 id="21-all-promises-fulfilled" style="position:relative;"><a href="#21-all-promises-fulfilled" aria-label="21 all promises fulfilled permalink" class="anchor before"></a>2.1 All promises fulfilled</h3>
<p>Let’s try to access the first resolved list from the local grocery store:</p>
<pre class="shiki github-light" style="background-color: #fff; color: #24292e"><div class="language-id">javascript</div><div class='code-container'><code><div class='line dim'><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">promise</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">Promise</span><span style="color: #24292E">.</span><span style="color: #6F42C1">any</span><span style="color: #24292E">([</span></div><div class='line highlight'><span style="color: #24292E">  </span><span style="color: #6F42C1">resolveTimeout</span><span style="color: #24292E">([</span><span style="color: #032F62">'potatoes'</span><span style="color: #24292E">, </span><span style="color: #032F62">'tomatoes'</span><span style="color: #24292E">], </span><span style="color: #005CC5">1000</span><span style="color: #24292E">),</span></div><div class='line highlight'><span style="color: #24292E">  </span><span style="color: #6F42C1">resolveTimeout</span><span style="color: #24292E">([</span><span style="color: #032F62">'oranges'</span><span style="color: #24292E">, </span><span style="color: #032F62">'apples'</span><span style="color: #24292E">], </span><span style="color: #005CC5">2000</span><span style="color: #24292E">)</span></div><div class='line dim'><span style="color: #24292E">]);</span></div><div class='line'></div><div class='line dim'><span style="color: #6A737D">// wait...</span></div><div class='line dim'><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">list</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> promise;</span></div><div class='line'></div><div class='line dim'><span style="color: #6A737D">// after 1 second</span></div><div class='line dim'><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(list); </span><span style="color: #6A737D">// logs ['potatoes', 'tomatoes']</span></div></code></div></pre>
<p><a href="https://codesandbox.io/s/first-fulfilled-w89h7?file=/src/index.js">Try the demo.</a></p>
<p><code>Promise.any([...])</code> returns a <code>promise</code> that resolves in 1 second to the list of vegetables <code>['potatoes', 'tomatoes']</code>. All because vegetables promise has fulfilled first.</p>
<p>The second promise, with the list of fruits, resolves in 2 seconds, but its value is ignored.</p>
<h3 id="22-one-promise-rejected" style="position:relative;"><a href="#22-one-promise-rejected" aria-label="22 one promise rejected permalink" class="anchor before"></a>2.2 One promise rejected</h3>
<p>Imagine there are no more vegetables at the grocery. In such a case, let’s reject the vegetables’ promise.</p>
<p>How would <code>Promise.any()</code> would work in such a case?</p>
<pre class="shiki github-light" style="background-color: #fff; color: #24292e"><div class="language-id">javascript</div><div class='code-container'><code><div class='line dim'><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">promise</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">Promise</span><span style="color: #24292E">.</span><span style="color: #6F42C1">any</span><span style="color: #24292E">([</span></div><div class='line highlight'><span style="color: #24292E">  </span><span style="color: #6F42C1">rejectTimeout</span><span style="color: #24292E">(</span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #005CC5">Error</span><span style="color: #24292E">(</span><span style="color: #032F62">"Out of vegetables!"</span><span style="color: #24292E">), </span><span style="color: #005CC5">1000</span><span style="color: #24292E">),</span></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #6F42C1">resolveTimeout</span><span style="color: #24292E">([</span><span style="color: #032F62">"oranges"</span><span style="color: #24292E">, </span><span style="color: #032F62">"apples"</span><span style="color: #24292E">], </span><span style="color: #005CC5">2000</span><span style="color: #24292E">)</span></div><div class='line dim'><span style="color: #24292E">]);</span></div><div class='line'></div><div class='line dim'><span style="color: #6A737D">// wait...</span></div><div class='line dim'><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">list</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> promise;</span></div><div class='line'></div><div class='line dim'><span style="color: #6A737D">// after 2 seconds</span></div><div class='line dim'><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(list); </span><span style="color: #6A737D">// logs ['oranges', 'apples']</span></div></code></div></pre>
<p><a href="https://codesandbox.io/s/one-rejected-dkxrw?file=/src/index.js">Try the demo.</a></p>
<p>This case is a little trickier.</p>
<p>First, the vegetables promise gets rejected after 1 second. However, <code>Promise.any()</code> does skip this rejection and still waits to see the status of fruits’ promise.</p>
<p>Finally, after one more second, the fruits promise resolves to a list of fruits <code>['oranges', 'apples']</code>. Right away the promise returned by <code>Promise.any([...])</code> also resolves to this value.</p>
<h3 id="23-all-promises-rejected" style="position:relative;"><a href="#23-all-promises-rejected" aria-label="23 all promises rejected permalink" class="anchor before"></a>2.3 All promises rejected</h3>
<p>What if the grocery is out of both vegetables and fruits? In such a case both promises reject:</p>
<pre class="shiki github-light" style="background-color: #fff; color: #24292e"><div class="language-id">javascript</div><div class='code-container'><code><div class='line dim'><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">promise</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">Promise</span><span style="color: #24292E">.</span><span style="color: #6F42C1">any</span><span style="color: #24292E">([</span></div><div class='line highlight'><span style="color: #24292E">  </span><span style="color: #6F42C1">rejectTimeout</span><span style="color: #24292E">(</span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #005CC5">Error</span><span style="color: #24292E">(</span><span style="color: #032F62">'Out of vegetables!'</span><span style="color: #24292E">), </span><span style="color: #005CC5">1000</span><span style="color: #24292E">),</span></div><div class='line highlight'><span style="color: #24292E">  </span><span style="color: #6F42C1">rejectTimeout</span><span style="color: #24292E">(</span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #005CC5">Error</span><span style="color: #24292E">(</span><span style="color: #032F62">'Out of fruits!'</span><span style="color: #24292E">), </span><span style="color: #005CC5">2000</span><span style="color: #24292E">)</span></div><div class='line dim'><span style="color: #24292E">]);</span></div><div class='line'></div><div class='line dim'><span style="color: #D73A49">try</span><span style="color: #24292E"> {</span></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #6A737D">// wait...</span></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">list</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> promise;</span></div><div class='line dim'><span style="color: #24292E">} </span><span style="color: #D73A49">catch</span><span style="color: #24292E"> (aggregateError) {</span></div><div class='line dim'><span style="color: #24292E">  console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(aggregateError); </span><span style="color: #6A737D">// logs AggregateError</span></div><div class='line dim'><span style="color: #24292E">  console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(aggregateError.errors); </span></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #6A737D">// logs [Error('Out of vegetables!'), Error('Out of fruits!')]</span></div><div class='line dim'><span style="color: #24292E">}</span></div></code></div></pre>
<p><a href="https://codesandbox.io/s/all-rejected-fbwgu?file=/src/index.js:283-297">Try the demo.</a></p>
<p>All input promises are rejected. Thus the promise returned by <code>Promise.any([...])</code> also gets rejected with a special kind of error — <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AggregateError">AggregateError</a> — that contains the rejection reasons of input promises.</p>
<p>The aggregate error provides a special property <code>errors</code>: which is an array containing the errors of the input promises that had been rejected.</p>
<h2 id="3-conclusion" style="position:relative;"><a href="#3-conclusion" aria-label="3 conclusion permalink" class="anchor before"></a>3. Conclusion</h2>
<p><code>Promise.any()</code> is useful to perform independent async operations in parallel in a race manner, to get the value of any first successfully resolved promise.</p>
<p>If all input promises of <code>Promise.any()</code> are rejected, then the promise returned by the helper function also rejects with an aggregate error, which contains the rejection reasons of the input promises inside a special property: <code>aggregateError.errors</code>.</p>
<p>Note that <code>Promise.any([])</code> rejects also if the input array is empty.</p>
<p><em>Challenge: what’s the main difference between <code>Promise.any()</code> and <code>Promise.race()</code>?</em></p></div>