---
title: How to Memoize with React.useMemo()
subtitle: Learn Gatsy now, its super!
date: 2021-05-10
slug: memoize-with-react.useMemo
author: Dmitri Pavlutin
rating: 1
coverImage: https://dmitripavlutin.com/static/0aa4516e77ea61877637a0dcc74cbfa6/65311/cover-6.webp
---

<p>In such cases, with care, you can try to improve the performance of your components using the <a href="https://en.wikipedia.org/wiki/Memoization">memoization</a> technique.</p>
<p>In this post, I’m going to describe how and when to use the <code>useMemo()</code> React hook.</p>
<h2 id="1-usememo-hook" style="position:relative;"><a href="#1-usememo-hook" aria-label="1 usememo hook permalink" class="anchor before"></a>1. <em>useMemo()</em> hook</h2>
<p><code>useMemo()</code> is a built-in React hook that accepts 2 arguments — a function <code>compute</code> that computes a result and the <code>depedencies</code> array:</p>
<pre class="shiki github-light" style="background-color: #fff; color: #24292e"><div class="language-id">javascript</div><div class='code-container'><code><div class='line'><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">memoizedResult</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">useMemo</span><span style="color: #24292E">(compute, dependencies);</span></div></code></div></pre>
<p>During initial rendering, <code>useMemo(compute, dependencies)</code> invokes <code>compute</code>, memoizes the calculation result, and returns it to the component.</p>
<p>If during next renderings the dependencies don’t change, then <code>useMemo()</code> <em>doesn’t invoke</em> <code>compute</code> but returns the memoized value.</p>
<p>But if dependencies change during re-rendering, then <code>useMemo()</code> <em>invokes</em> <code>compute</code>, memoizes the new value, and returns it.</p>
<p>That’s the essence of <code>useMemo()</code> hook.</p>
<p>If your computation callback uses props or state values, then be sure to indicate these values as dependencies:</p>
<pre class="shiki github-light" style="background-color: #fff; color: #24292e"><div class="language-id">javascript</div><div class='code-container'><code><div class='line dim'><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">memoizedResult</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">useMemo</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">expensiveFunction</span><span style="color: #24292E">(propA, propB);</span></div><div class='line highlight'><span style="color: #24292E">}, [propA, propB]);</span></div></code></div></pre>
<p>Now let’s see how <code>useMemo()</code> works in an example.</p>
<h2 id="2-usememo--an-example" style="position:relative;"><a href="#2-usememo--an-example" aria-label="2 usememo  an example permalink" class="anchor before"></a>2. <em>useMemo()</em> — an example</h2>
<p>A component <code>&#x3C;CalculateFactorial /></code> calculates the factorial of a number introduced into an input field.</p>
<p>Here’s a possible implementation of <code>&#x3C;CalculateFactorial /></code> component:</p>
<pre class="shiki github-light" style="background-color: #fff; color: #24292e"><div class="language-id">jsx</div><div class='code-container'><code><div class='line dim'><span style="color: #D73A49">import</span><span style="color: #24292E"> { useState } </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'react'</span><span style="color: #24292E">;</span></div><div class='line'></div><div class='line dim'><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">CalculateFactorial</span><span style="color: #24292E">() {</span></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> [</span><span style="color: #005CC5">number</span><span style="color: #24292E">, </span><span style="color: #005CC5">setNumber</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">useState</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> [</span><span style="color: #005CC5">inc</span><span style="color: #24292E">, </span><span style="color: #005CC5">setInc</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">useState</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></div><div class='line'></div><div class='line highlight'><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">factorial</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">factorialOf</span><span style="color: #24292E">(number);</span></div><div class='line'></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">onChange</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #E36209">event</span><span style="color: #24292E"> </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></div><div class='line dim'><span style="color: #24292E">    </span><span style="color: #6F42C1">setNumber</span><span style="color: #24292E">(</span><span style="color: #005CC5">Number</span><span style="color: #24292E">(event.target.value));</span></div><div class='line dim'><span style="color: #24292E">  };</span></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">onClick</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">setInc</span><span style="color: #24292E">(</span><span style="color: #E36209">i</span><span style="color: #24292E"> </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> i </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></div><div class='line dim'><span style="color: #24292E">  </span></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> (</span></div><div class='line dim'><span style="color: #24292E">    &lt;</span><span style="color: #22863A">div</span><span style="color: #24292E">&gt;</span></div><div class='line dim'><span style="color: #24292E">      Factorial of </span></div><div class='line dim'><span style="color: #24292E">      &lt;</span><span style="color: #22863A">input</span><span style="color: #24292E"> </span><span style="color: #6F42C1">type</span><span style="color: #D73A49">=</span><span style="color: #032F62">"number"</span><span style="color: #24292E"> </span><span style="color: #6F42C1">value</span><span style="color: #D73A49">=</span><span style="color: #24292E">{number} </span><span style="color: #6F42C1">onChange</span><span style="color: #D73A49">=</span><span style="color: #24292E">{onChange} /&gt;</span></div><div class='line dim'><span style="color: #24292E">      is {factorial}</span></div><div class='line dim'><span style="color: #24292E">      &lt;</span><span style="color: #22863A">button</span><span style="color: #24292E"> </span><span style="color: #6F42C1">onClick</span><span style="color: #D73A49">=</span><span style="color: #24292E">{onClick}&gt;Re-render&lt;/</span><span style="color: #22863A">button</span><span style="color: #24292E">&gt;</span></div><div class='line dim'><span style="color: #24292E">    &lt;/</span><span style="color: #22863A">div</span><span style="color: #24292E">&gt;</span></div><div class='line dim'><span style="color: #24292E">  );</span></div><div class='line dim'><span style="color: #24292E">}</span></div><div class='line'></div><div class='line dim'><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">factorialOf</span><span style="color: #24292E">(</span><span style="color: #E36209">n</span><span style="color: #24292E">) {</span></div><div class='line dim'><span style="color: #24292E">  console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">'factorialOf(n) called!'</span><span style="color: #24292E">);</span></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E"> </span><span style="color: #D73A49">?</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E"> </span><span style="color: #D73A49">:</span><span style="color: #24292E"> n </span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">factorialOf</span><span style="color: #24292E">(n </span><span style="color: #D73A49">-</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></div><div class='line dim'><span style="color: #24292E">}</span></div></code></div></pre>
<p><a href="https://codesandbox.io/s/factorial-without-memoization-26yp4?file=/src/App.js">Try the demo.</a></p>
<p>Every time you change the input value, the factorial is calculated <code>factorialOf(n)</code> and <code>'factorialOf(n) called!'</code> is logged to console.</p>
<p>On the other side, each time you click <em>Re-render</em> button, <code>inc</code> state value is updated. Updating <code>inc</code> state value triggers <code>&#x3C;CalculateFactorial /></code> re-rendering. But, as a secondary effect, during re-rendering the factorial is recalculated again — <code>'factorialOf(n) called!'</code> is logged to console.</p>
<p>How can you memoize the factorial calculation when the component re-renders? Welcome <code>useMemo()</code> hook!</p>
<p>By using <code>useMemo(() => factorialOf(number), [number])</code> instead of simple <code>factorialOf(number)</code>, React memoizes the factorial calculation.</p>
<p>Let’s improve <code>&#x3C;CalculateFactorial /></code> and memoize the factorial calculation:</p>
<pre class="shiki github-light" style="background-color: #fff; color: #24292e"><div class="language-id">jsx</div><div class='code-container'><code><div class='line dim'><span style="color: #D73A49">import</span><span style="color: #24292E"> { useState, useMemo } </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'react'</span><span style="color: #24292E">;</span></div><div class='line'></div><div class='line dim'><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">CalculateFactorial</span><span style="color: #24292E">() {</span></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> [</span><span style="color: #005CC5">number</span><span style="color: #24292E">, </span><span style="color: #005CC5">setNumber</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">useState</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> [</span><span style="color: #005CC5">inc</span><span style="color: #24292E">, </span><span style="color: #005CC5">setInc</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">useState</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></div><div class='line'></div><div class='line highlight'><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">factorial</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">useMemo</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">factorialOf</span><span style="color: #24292E">(number), [number]);</span></div><div class='line'></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">onChange</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #E36209">event</span><span style="color: #24292E"> </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></div><div class='line dim'><span style="color: #24292E">    </span><span style="color: #6F42C1">setNumber</span><span style="color: #24292E">(</span><span style="color: #005CC5">Number</span><span style="color: #24292E">(event.target.value));</span></div><div class='line dim'><span style="color: #24292E">  };</span></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">onClick</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">setInc</span><span style="color: #24292E">(</span><span style="color: #E36209">i</span><span style="color: #24292E"> </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> i </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></div><div class='line dim'><span style="color: #24292E">  </span></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> (</span></div><div class='line dim'><span style="color: #24292E">    &lt;</span><span style="color: #22863A">div</span><span style="color: #24292E">&gt;</span></div><div class='line dim'><span style="color: #24292E">      Factorial of </span></div><div class='line dim'><span style="color: #24292E">      &lt;</span><span style="color: #22863A">input</span><span style="color: #24292E"> </span><span style="color: #6F42C1">type</span><span style="color: #D73A49">=</span><span style="color: #032F62">"number"</span><span style="color: #24292E"> </span><span style="color: #6F42C1">value</span><span style="color: #D73A49">=</span><span style="color: #24292E">{number} </span><span style="color: #6F42C1">onChange</span><span style="color: #D73A49">=</span><span style="color: #24292E">{onChange} /&gt;</span></div><div class='line dim'><span style="color: #24292E">      is {factorial}</span></div><div class='line dim'><span style="color: #24292E">      &lt;</span><span style="color: #22863A">button</span><span style="color: #24292E"> </span><span style="color: #6F42C1">onClick</span><span style="color: #D73A49">=</span><span style="color: #24292E">{onClick}&gt;Re-render&lt;/</span><span style="color: #22863A">button</span><span style="color: #24292E">&gt;</span></div><div class='line dim'><span style="color: #24292E">    &lt;/</span><span style="color: #22863A">div</span><span style="color: #24292E">&gt;</span></div><div class='line dim'><span style="color: #24292E">  );</span></div><div class='line dim'><span style="color: #24292E">}</span></div><div class='line'></div><div class='line dim'><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">factorialOf</span><span style="color: #24292E">(</span><span style="color: #E36209">n</span><span style="color: #24292E">) {</span></div><div class='line dim'><span style="color: #24292E">  console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">'factorialOf(n) called!'</span><span style="color: #24292E">);</span></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E"> </span><span style="color: #D73A49">?</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E"> </span><span style="color: #D73A49">:</span><span style="color: #24292E"> n </span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">factorialOf</span><span style="color: #24292E">(n </span><span style="color: #D73A49">-</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></div><div class='line dim'><span style="color: #24292E">}</span></div></code></div></pre>
<p><a href="https://codesandbox.io/s/factorial-with-memoization-65mkk?file=/src/App.js">Try the demo.</a></p>
<p>Open the <a href="https://codesandbox.io/s/factorial-with-memoization-65mkk?file=/src/App.js">demo</a>. Every time you change the value of the number, <code>'factorialOf(n) called!'</code> is logged to console. That’s expected.</p>
<p>However, if you click <em>Re-render</em> button, <code>'factorialOf(n) called!'</code> isn’t logged to console because <code>useMemo(() => factorialOf(number), [number])</code> returns the memoized factorial calculation. Great!</p>
<h2 id="3-usememo-vs-usecallback" style="position:relative;"><a href="#3-usememo-vs-usecallback" aria-label="3 usememo vs usecallback permalink" class="anchor before"></a>3. <em>useMemo()</em> vs <em>useCallback()</em></h2>
<p><code>useCallback()</code>, compared to <code>useMemo()</code>, is a more specialized hook that memoizes callbacks:</p>
<pre class="shiki github-light" style="background-color: #fff; color: #24292e"><div class="language-id">jsx</div><div class='code-container'><code><div class='line dim'><span style="color: #D73A49">import</span><span style="color: #24292E"> { useCallback } </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'react'</span><span style="color: #24292E">;</span></div><div class='line'></div><div class='line dim'><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyComponent</span><span style="color: #24292E">({ </span><span style="color: #E36209">prop</span><span style="color: #24292E"> }) {</span></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">callback</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></div><div class='line dim'><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #032F62">'Result'</span><span style="color: #24292E">;</span></div><div class='line dim'><span style="color: #24292E">  };</span></div><div class='line highlight'><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">memoizedCallback</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">useCallback</span><span style="color: #24292E">(callback, [prop]);</span></div><div class='line dim'><span style="color: #24292E">  </span></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> &lt;</span><span style="color: #005CC5">ChildComponent</span><span style="color: #24292E"> </span><span style="color: #6F42C1">callback</span><span style="color: #D73A49">=</span><span style="color: #24292E">{memoizedCallback} /&gt;;</span></div><div class='line dim'><span style="color: #24292E">}</span></div></code></div></pre>
<p>In the above example, <code>useCallback(() => {...}, [prop])</code> returns the same function instance as long as <code>prop</code> dependency is the same.</p>
<p>You can use the same way the <code>useMemo()</code> to memoize callbacks:</p>
<pre class="shiki github-light" style="background-color: #fff; color: #24292e"><div class="language-id">jsx</div><div class='code-container'><code><div class='line dim'><span style="color: #D73A49">import</span><span style="color: #24292E"> { useMemo } </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'react'</span><span style="color: #24292E">;</span></div><div class='line'></div><div class='line dim'><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyComponent</span><span style="color: #24292E">({ </span><span style="color: #E36209">prop</span><span style="color: #24292E"> }) {</span></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">callback</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></div><div class='line dim'><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #032F62">'Result'</span><span style="color: #24292E">;</span></div><div class='line dim'><span style="color: #24292E">  };</span></div><div class='line highlight'><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">memoizedCallback</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">useMemo</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> callback, [prop]);</span></div><div class='line dim'><span style="color: #24292E">  </span></div><div class='line dim'><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> &lt;</span><span style="color: #005CC5">ChildComponent</span><span style="color: #24292E"> </span><span style="color: #6F42C1">callback</span><span style="color: #D73A49">=</span><span style="color: #24292E">{memoizedCallback} /&gt;;</span></div><div class='line dim'><span style="color: #24292E">}</span></div></code></div></pre>
<h2 id="4-use-memoization-with-care" style="position:relative;"><a href="#4-use-memoization-with-care" aria-label="4 use memoization with care permalink" class="anchor before"></a>4. Use memoization with care</h2>
<p>While <code>useMemo()</code> can improve the performance of the component, you have to make sure to profile the component with and without the hook. Only after that make the conclusion whether memoization worth it.</p>
<p>When memoization is used inappropriately, it could harm the performance.</p>
<h2 id="5-conclusion" style="position:relative;"><a href="#5-conclusion" aria-label="5 conclusion permalink" class="anchor before"></a>5. Conclusion</h2>
<p><code>useMemo(() => computation(a, b), [a, b])</code> is the hook that lets you memoize expensive computations. Given the same <code>[a, b]</code> dependencies, once memoized, the hook is
going to return the memoized value without invoking <code>computation(a, b)</code>.</p>
<p>Also check the post <a href="/dont-overuse-react-usecallback/">Your Guide to React.useCallback()</a> if you’d like to read about <code>useCallback()</code> hook.</p></div>